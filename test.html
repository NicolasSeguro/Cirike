<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <title>Test</title>
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="bg-body-cirike">
    <!-- Header -->
    <header id="header">
        <nav class="navbar navbar-expand-lg bg-body-cirike">
            <div class="container-fluid">
              <a class="navbar-brand" href="#">
                <img src="assets/images/logo/logo-outline-small 1.png" alt="">
                <!-- Hillsong buenos aires -->
              </a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                  <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="index.html">Inicio</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="index.html#abc">ABC</a>
                  </li>
                </ul>
              </div>
            </div>
          </nav>
    </header>
    <!-- Fin Header -->
  <div class="container">
    <h1>Test</h1>
    <form id="test-form">
      <div class="question">
        <h3>1. Misión como Hillsong. Marca la respuesta correcta</h3>
        <div class="options">
          <label>
            <input type="radio" name="q1" value="A"> Amar a Dios y a las personas
          </label>
          <label>
            <input type="radio" name="q1" value="B"> Crear una iglesia saludable que pueda cambiar la vida de las personas a través de Jesús (respuesta correcta)
          </label>
          <label>
            <input type="radio" name="q1" value="C"> Ayudar a los más necesitados
          </label>
        </div>
      </div>
      <div class="question">
        <h3>2. ¿Cómo debe ser el impacto?</h3>
        <div class="options">
          <label>
            <input type="checkbox" name="q2" value="A"> Sostenible (correcta)
          </label>
          <label>
            <input type="checkbox" name="q2" value="B"> Social (correcta)
          </label>
          <label>
            <input type="checkbox" name="q2" value="C"> Constante
          </label>
          <label>
            <input type="checkbox" name="q2" value="D"> Para todos
          </label>
          <label>
            <input type="checkbox" name="q2" value="E"> Integral
          </label>
        </div>
      </div>
      <div class="question">
        <h3>3. Termina la oración: Hillsong citycare es el .....</h3>
        <input type="text" name="q3">
      </div>
      <div class="question">
        <h3>4. ¿Qué hacemos con citycare? Marcar la respuesta correcta</h3>
        <div class="options">
          <label>
            <input type="checkbox" name="q4" value="A"> Mostrar el amor de Jesús
          </label>
          <label>
            <input type="checkbox" name="q4" value="B"> Empoderar
          </label>
          <label>
            <input type="checkbox" name="q4" value="C"> Acompañar
          </label>
          <label>
            <input type="checkbox" name="q4" value="D"> Equipar
          </label>
          <label>
            <input type="checkbox" name="q4" value="E"> Verlos florecer
          </label>
          <label>
            <input type="checkbox" name="q4" value="F"> Romper el ciclo de la pobreza
          </label>
          <label>
            <input type="checkbox" name="q4" value="G"> Todas son correctas (correcta)
          </label>
        </div>
      </div>
      <div class="question">
        <h3>5. Menciona algunas de las excusas que tenemos para hacer CityCare</h3>
        <textarea name="q5"></textarea>
      </div>
      <div class="question">
        <h3>6. Reglas de oro. ¿Cuáles recuerdas que se han mencionado?</h3>
        <div class="options">
          <label>
            <input type="checkbox" name="q6" value="A"> Disfruta el servicio (correcta)
          </label>
          <label>
            <input type="checkbox" name="q6" value="B"> Tenemos compromiso (correcta)
          </label>
          <label>
            <input type="checkbox" name="q6" value="C"> No damos los datos personales (correcta)
          </label>
          <label>
            <input type="checkbox" name="q6" value="D"> No damos dinero (correcta)
          </label>
          <label>
            <input type="checkbox" name="q6" value="E"> No hacemos promesas (correcta)
          </label>
          <label>
            <input type="checkbox" name="q6" value="F"> No rascamos en la historia personal del otro (correcta)
          </label>
          <label>
            <input type="checkbox" name="q6" value="G"> Lloramos cuando nos cuentan cosas duras
          </label>
          <label>
            <input type="checkbox" name="q6" value="H"> Les pedimos el número de teléfono y les hacemos seguimiento
          </label>
          <label>
            <input type="checkbox" name="q6" value="I"> Los contactamos por Instagram
          </label>
          <label>
            <input type="checkbox" name="q6" value="J"> Les sacamos fotos y los etiquetamos en redes
          </label>
        </div>
      </div>
      <div class="question">
        <h3>7. Respecto a los niños, ¿cuáles son las sugerencias para cuidarlos? Marca las correctas.</h3>
        <div class="options">
          <label>
            <input type="checkbox" name="q7" value="A"> No nos quedamos solos con ellos (correcta)
          </label>
          <label>
            <input type="checkbox" name="q7" value="B"> Los abrazamos
          </label>
          <label>
            <input type="checkbox" name="q7" value="C"> Los acompañamos al baño sin problema
          </label>
          <label>
            <input type="checkbox" name="q7" value="D"> No les sacamos fotos y los etiquetamos en redes (correcta)
          </label>
          <label>
            <input type="checkbox" name="q7" value="E"> Les hacemos regalos
          </label>
          <label>
            <input type="checkbox" name="q7" value="F"> Es normal tener favoritos y hacer diferencias entre ellos
          </label>
          <label>
            <input type="checkbox" name="q7" value="G"> Les pedimos su teléfono y les enviamos mensajes de WhatsApp
          </label>
          <label>
            <input type="checkbox" name="q7" value="H"> No les hacemos promesas (correcta)
          </label>
        </div>
      </div>
      <button type="button" id="submit-btn">Enviar respuestas</button>
    </form>
  </div>
  <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Muchas gracias por tu servicio</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            Completa el archivo que se descargó y envialo por email a <strong>citycareba@gmail.com</strong> para finalizar el proceso
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
        </div>
    </div>
  <!-- Footer -->
  <footer class="p-lg-5 m-0">
    <div class="text-center">
        <a class="navbar-brand" href="#"></a>
            <img src="assets/images/logo/logo-outline-small 1.png" alt="">
            <p>Hillsong buenos aires</p>
        </a>
    </div>
</footer>
<!-- Fin footer -->

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>

  <!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-app.js"></script>
<!-- Firebase Firestore -->
<script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-firestore.js"></script>
<!-- Firebase Authentication -->
<script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-auth.js"></script>
<!-- Firebase Realtime Database -->
<script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-database.js"></script>


  <script>
    // Configura la conexión con Firebase
    var firebaseConfig = {
        apiKey: "AIzaSyDnD16spdFbTw3nUycWhpNQaPGbTYd9kOI",
        authDomain: "cirike-141a3.firebaseapp.com",
        databaseURL: 'https://cirike-141a3-default-rtdb.firebaseio.com/',
        projectId: "cirike-141a3",
        storageBucket: "cirike-141a3.appspot.com",
        messagingSenderId: "1035532664225",
        appId: "1:1035532664225:web:f6d61bee88326ecffa9fe0",
        measurementId: "G-NRM5892FT1"
    };
    firebase.initializeApp(firebaseConfig);
    
    var database = firebase.database();

    // Función para validar las respuestas del test
    function validarRespuestas() {
      var respuestas = {
        q1: $('input[name="q1"]:checked').val(),
        q2: $('input[name="q2"]:checked').map(function() { return $(this).val(); }).get(),
        q3: $('input[name="q3"]').val(),
        q4: $('input[name="q4"]:checked').map(function() { return $(this).val(); }).get(),
        q5: $('textarea[name="q5"]').val(),
        q6: $('input[name="q6"]:checked').map(function() { return $(this).val(); }).get(),
        q7: $('input[name="q7"]:checked').map(function() { return $(this).val(); }).get(),
      };

      // Respuestas correctas
      var respuestasCorrectas = {
        q1: 'B',
        q2: ['A', 'B'],
        q3: 'corazón de la iglesia',
        q4: ['A', 'B', 'C', 'D', 'E', 'F', 'G'],
        q5: '', // Inserta las respuestas correctas para la pregunta 5
        q6: ['A', 'B', 'C', 'D', 'E', 'F'],
        q7: ['A', 'D', 'H'],
      };

      // Valida las respuestas
      var aciertos = 0;
      var totalPreguntas = 7;

      // Pregunta 1
      if (respuestas.q1 === respuestasCorrectas.q1) {
        aciertos++;
        $('#question1').addClass('correct');
      } else {
        $('#question1').addClass('incorrect');
      }

      // Pregunta 2
      var q2RespuestasCorrectas = respuestasCorrectas.q2;
      var q2RespuestasSeleccionadas = respuestas.q2;
      var q2Correcto = q2RespuestasCorrectas.length === q2RespuestasSeleccionadas.length && q2RespuestasCorrectas.every(function(val) {
        return q2RespuestasSeleccionadas.indexOf(val) !== -1;
      });
      if (q2Correcto) {
        aciertos++;
        $('#question2').addClass('correct');
      } else {
        $('#question2').addClass('incorrect');
      }

      // Pregunta 3
      if (respuestas.q3.toLowerCase() === respuestasCorrectas.q3.toLowerCase()) {
        aciertos++;
        $('#question3').addClass('correct');
      } else {
        $('#question3').addClass('incorrect');
      }

      // Pregunta 4
      var q4RespuestasCorrectas = respuestasCorrectas.q4;
      var q4RespuestasSeleccionadas = respuestas.q4;
      var q4Correcto = q4RespuestasCorrectas.length === q4RespuestasSeleccionadas.length && q4RespuestasCorrectas.every(function(val) {
        return q4RespuestasSeleccionadas.indexOf(val) !== -1;
      });
      if (q4Correcto) {
        aciertos++;
        $('#question4').addClass('correct');
      } else {
        $('#question4').addClass('incorrect');
      }

      // Pregunta 5
      if (respuestas.q5.toLowerCase() === respuestasCorrectas.q5.toLowerCase()) {
        aciertos++;
        $('#question5').addClass('correct');
      } else {
        $('#question5').addClass('incorrect');
      }

      // Pregunta 6
      var q6RespuestasCorrectas = respuestasCorrectas.q6;
      var q6RespuestasSeleccionadas = respuestas.q6;
      var q6Correcto = q6RespuestasCorrectas.length === q6RespuestasSeleccionadas.length && q6RespuestasCorrectas.every(function(val) {
        return q6RespuestasSeleccionadas.indexOf(val) !== -1;
      });
      if (q6Correcto) {
        aciertos++;
        $('#question6').addClass('correct');
      } else {
        $('#question6').addClass('incorrect');
      }

      // Pregunta 7
      var q7RespuestasCorrectas = respuestasCorrectas.q7;
      var q7RespuestasSeleccionadas = respuestas.q7;
      var q7Correcto = q7RespuestasCorrectas.length === q7RespuestasSeleccionadas.length && q7RespuestasCorrectas.every(function(val) {
        return q7RespuestasSeleccionadas.indexOf(val) !== -1;
      });
      if (q7Correcto) {
        aciertos++;
        $('#question7').addClass('correct');
      } else {
        $('#question7').addClass('incorrect');
      }

      // Guarda los resultados en la base de datos
      var user = firebase.auth().currentUser;
      if (user) {
        var userId = user.uid;
        var testResultRef = database.ref('testResults/' + userId);
        testResultRef.set({
          usuario: user.email,
          respuestas: respuestas,
          aciertos: aciertos,
          totalPreguntas: totalPreguntas,
        }).then(function() {
        // Respuestas enviadas correctamente, abrir el modal
        var modal = new bootstrap.Modal(document.getElementById('exampleModal'));
        modal.show();
        // Generar la descarga del archivo
        descargarArchivo();
        });
      }
    }

    // Función para generar la descarga del archivo
    function descargarArchivo() {
        // Código para generar la descarga del archivo
        var link = document.createElement('a');
        link.href = 'assets/doc/Voluntariado.docx';  
        link.download = 'Voluntariado.docx';  
        link.click();
    }

    // Event listener para el botón de envío de respuestas
    $('#submit-btn').click(function() {
      validarRespuestas();
    });

  // Acceder al formulario
  const form = document.getElementById('test-form');

  // Manejar el envío del formulario
  form.addEventListener('submit', (e) => {
    e.preventDefault(); // Prevenir la recarga de la página

    // Crear un objeto para almacenar las respuestas
    let answers = {};

    // Iterar sobre cada elemento del formulario
    for (let i = 0; i < form.elements.length; i++) {
      let elem = form.elements[i];

      // Solo considerar los campos de entrada que tienen un nombre y un valor
      if (elem.name && elem.value) {
        // Asegurarte de que puedes manejar múltiples respuestas para una pregunta (para checkbox)
        if (elem.type === 'checkbox' && elem.checked) {
          // Si ya existe una respuesta para esta pregunta, añadir a ella
          if (answers[elem.name]) {
            answers[elem.name].push(elem.value);
          }
          // Si no, crear una nueva respuesta
          else {
            answers[elem.name] = [elem.value];
          }
        }
        // Para otros tipos de entrada (radio, texto, etc.)
        else if (elem.type !== 'checkbox') {
          answers[elem.name] = elem.value;
        }
      }
    }

    console.log('Probando si llega hasta acá');
    // Añadir la fecha y hora actuales a las respuestas
    answers.timestamp = firebase.firestore.FieldValue.serverTimestamp();

    firebase.firestore().collection('tests').add(answers)
    .then(() => {
        console.log('Respuestas guardadas exitosamente');
        var myModal = new bootstrap.Modal(document.getElementById('exampleModal'));
        myModal.show();
    })
    .catch((error) => {
        console.error('Error al guardar las respuestas: ', error);
        // Aquí puedes mostrar un mensaje de error al usuario
    });
    });


  </script>
  
</body>
</html>
